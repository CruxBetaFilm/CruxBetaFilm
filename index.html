<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Crux&Beta Film - Fotograf√≠a & Video</title>

  <!-- Tailwind (para pruebas) -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;800;900&display=swap" rel="stylesheet"/>

  <style>
    :root{
      --black:#0a0a0a; --gray-900:#121212; --gray-800:#1e1e1e; --border:rgba(255,255,255,.14);
      --gold:#c8a035; --gold-2:#a07a18; --gold-3:#f3e2a5; --accent:#c47c3b;
    }
    html,body{height:100%}
    body{font-family:'Inter',system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial;background:var(--black);color:#ececec}
    .hidden-route{display:none!important}
    .subtext{color:#d8d8d8}
    body.lock{height:100vh;overflow:hidden}

    /* ===== Botones ===== */
    .btn-gold{position:relative;background:linear-gradient(180deg,var(--gold-3),var(--gold));color:#141414;border:1px solid rgba(255,255,255,.18);box-shadow:0 10px 28px rgba(200,160,53,.22);transition:transform .18s ease,filter .18s ease}
    .btn-gold:hover{transform:translateY(-1px);filter:brightness(1.06)}
    .btn-gold-outline{position:relative;background:rgba(255,255,255,.02);color:var(--gold-3);border:1px solid rgba(200,160,53,.55);box-shadow:0 8px 24px rgba(0,0,0,.24);transition:transform .18s ease,filter .18s ease}
    .btn-gold-outline:hover{transform:translateY(-1px);filter:brightness(1.08)}
    .btn-sheen::after{content:"";position:absolute;inset:0;transform:translateX(-120%) skewX(12deg);background:linear-gradient(90deg,transparent,rgba(255,255,255,.5),transparent);animation:sheen 2.2s infinite;mix-blend-mode:screen}
    @keyframes sheen{0%{transform:translateX(-120%) skewX(12deg)}60%{transform:translateX(120%) skewX(12deg)}100%{transform:translateX(120%) skewX(12deg)}}

    /* ===== Panel / Card ===== */
    .panel{position:relative;background:linear-gradient(180deg,rgba(255,255,255,.03),rgba(255,255,255,.02));border:1px solid var(--border);box-shadow:0 20px 50px rgba(0,0,0,.6);backdrop-filter:blur(8px);border-radius:16px}
    .card{position:relative;border:1px solid var(--border);background:rgba(255,255,255,.04);box-shadow:0 0 0 1px rgba(255,255,255,.02) inset,0 20px 60px -20px rgba(0,0,0,.6);transition:transform .25s ease,box-shadow .25s ease,border-color .25s ease;border-radius:14px}
    .card:hover{transform:translateY(-4px);box-shadow:0 0 0 1px rgba(212,175,55,.18) inset,0 30px 80px -20px rgba(212,175,55,.25);border-color:rgba(212,175,55,.35)}

    .badge-accent{background:linear-gradient(180deg,rgba(196,124,59,.95),rgba(160,122,24,.95));color:#fff;border:1px solid rgba(255,255,255,.18)}
    .floating-note{animation:float 3s ease-in-out infinite}
    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-5px)}}
    .hrule{height:2px;width:72px;margin:.75rem 0 1rem;background:linear-gradient(90deg,var(--gold-2),var(--gold-3),transparent);border-radius:999px;opacity:.95}

    /* ===== Portafolio (sin animaciones + masonry + anti-descarga) ===== */
    /* Contenedor masonry por columnas (fluido, impactante) */
    .masonry{column-count:1;column-gap:16px}
    @media(min-width:640px){.masonry{column-count:2}}
    @media(min-width:1024px){.masonry{column-count:3}}
    @media(min-width:1280px){.masonry{column-count:4}}

    /* Tarjeta de foto: SIN animaciones, aspecto fuerte */
    .tile{
      display:block; width:100%; margin:0 0 16px; break-inside:avoid; position:relative; isolation:isolate;
      border:1px solid var(--border); border-radius:14px; overflow:hidden; background:#0d0d0d;
      background-size:cover; background-position:center; cursor:zoom-in;
      /* anti-descarga (dif√≠cil extraer v√≠a arrastre/long-press) */
      -webkit-user-drag:none; user-select:none; -webkit-touch-callout:none;
    }
    /* Esquinas y borde m√°s visibles */
    .tile::before{
      content:""; position:absolute; inset:0; border-radius:inherit; pointer-events:none;
      box-shadow:inset 0 0 0 1px rgba(255,255,255,.04);
    }
    /* Lupa */
    .tile .loupe{
      position:absolute; inset:auto auto 10px 10px; width:36px; height:36px; border-radius:999px;
      background:rgba(0,0,0,.55);
      border:1px solid rgba(255,255,255,.18);
      display:flex; align-items:center; justify-content:center; opacity:.9;
    }
    .tile .loupe svg{width:18px;height:18px;opacity:.9}

    /* Subt√≠tulo/etiqueta */
    .slot--badge{position:absolute;left:10px;top:10px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.18);backdrop-filter:blur(4px);padding:4px 8px;border-radius:10px;font-size:12px;color:#fff}

    /* Placeholder si no existe */
    .slot--empty{
      display:flex;align-items:center;justify-content:center; background:linear-gradient(180deg,rgba(255,255,255,.015),rgba(255,255,255,.03));
      border:1px dashed rgba(200,160,53,.35); color:#cbb77a; border-radius:14px; height:260px;
    }

    /* Tabs */
    .tabbar{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center}
    .tab-btn{padding:.55rem 1rem;border:1px solid rgba(200,160,53,.45);border-radius:9999px;font-weight:800;letter-spacing:.2px;background:rgba(255,255,255,.02);color:var(--gold-3);cursor:pointer;transition:.18s}
    .tab-btn.active{background:linear-gradient(180deg,var(--gold-3),var(--gold));color:#111;box-shadow:0 8px 22px rgba(200,160,53,.28)}
    .subtabs{display:flex;gap:.5rem;flex-wrap:wrap;justify-content:center;margin:.75rem 0 1.25rem}
    .subtab-btn{padding:.4rem .85rem;border:1px dashed rgba(200,160,53,.35);border-radius:9999px;font-weight:700;color:#e7e7e7;background:rgba(255,255,255,.02);cursor:pointer;transition:.18s}
    .subtab-btn.active{border-style:solid;color:#111;background:linear-gradient(180deg,var(--gold-3),var(--gold))}

    /* Lightbox + Zoom (con bot√≥n X) */
    #lightbox::backdrop{background:rgba(0,0,0,.88)}
    #lightbox[open]{padding:0;border:0;background:transparent}
    .lb-wrap{position:relative;min-width:min(92vw,1200px);min-height:min(92vh,800px);display:flex;align-items:center;justify-content:center;background:#000;border-radius:12px;overflow:hidden}
    #lbImg{max-width:none;max-height:none;transform-origin:50% 50%}
    .lb-ctrl{position:absolute;top:50%;transform:translateY(-50%);background:rgba(0,0,0,.65);color:#fff;border:1px solid rgba(255,255,255,.25);width:44px;height:44px;border-radius:999px;display:flex;align-items:center;justify-content:center;font-size:24px}
    #lbPrev{left:8px} #lbNext{right:8px}
    .lb-toolbar{
      position:absolute;left:50%;bottom:10px;transform:translateX(-50%);
      display:flex;gap:8px;background:rgba(0,0,0,.55);border:1px solid rgba(255,255,255,.2);padding:6px;border-radius:999px;
    }
    .lb-btn{
      width:40px;height:40px;border-radius:999px;border:1px solid rgba(255,255,255,.2);
      background:rgba(20,20,20,.7); color:#fff; display:flex; align-items:center; justify-content:center; font-weight:900;
    }
    .lb-close{
      position:absolute;top:8px;right:8px;width:44px;height:44px;border-radius:999px;border:1px solid rgba(255,255,255,.25);
      background:rgba(0,0,0,.65);color:#fff;font-size:22px;display:flex;align-items:center;justify-content:center
    }

    /* Anti selecci√≥n en zona de im√°genes */
    .no-select{-webkit-user-select:none;user-select:none;-webkit-touch-callout:none}
  </style>
</head>

<body class="min-h-screen no-select">
  <!-- HOME -->
  <section data-route="home" class="min-h-screen flex items-center justify-center relative overflow-hidden px-6">
    <div class="pointer-events-none absolute inset-0 opacity-25 grayscale bg-[url('https://images.unsplash.com/photo-1499084732479-de2c02d45fc4?q=80&w=1600&auto=format&fit=crop')] bg-cover bg-center"></div>
    <div class="pointer-events-none absolute inset-0 bg-gradient-to-b from-black/60 to-black/90"></div>
    <div class="relative z-10 text-center max-w-3xl">
      <img src="https://raw.githubusercontent.com/edgarces9/Mi-primera-p-gina-/main/IMG_1135.png" alt="Logo de Crux&Beta Film" class="mx-auto mb-5 rounded-full w-32 h-32 border border-white/20 object-cover"/>
      <h1 class="text-4xl sm:text-6xl font-black tracking-tight bg-clip-text text-transparent" style="background-image:linear-gradient(90deg,var(--gold-3),var(--gold),var(--gold-2))">Crux&Beta Film</h1>
      <p class="mt-3 text-lg sm:text-2xl subtext">Fotograf√≠a &amp; Video con un look formal y atemporal</p>
      <nav class="mt-7 flex flex-wrap items-center justify-center gap-3" aria-label="Navegaci√≥n principal">
        <a href="#paquetes"  class="btn-gold btn-sheen font-extrabold px-6 py-3 rounded-full">Ver paquetes</a>
        <a href="#contacto"  class="btn-gold-outline btn-sheen font-extrabold px-6 py-3 rounded-full">Contacto</a>
        <a href="#portafolio" class="btn-gold-outline btn-sheen font-extrabold px-6 py-3 rounded-full">Portafolio</a>
        <a href="#opiniones" class="btn-gold-outline btn-sheen font-extrabold px-6 py-3 rounded-full">Opiniones</a>
      </nav>
    </div>
  </section>

  <!-- PAQUETES -->
  <section data-route="paquetes" class="hidden-route min-h-screen flex items-center justify-center px-4 py-12">
    <div class="panel max-w-6xl w-full rounded-2xl p-6 sm:p-10 bg-black/40">
      <div class="flex items-center gap-3 mb-6">
        <a href="#home" class="btn-gold-outline btn-sheen px-4 py-2 rounded-full font-bold">‚Üê Volver</a>
        <h2 class="text-3xl sm:text-4xl font-extrabold">Paquetes</h2>
      </div>

      <div class="text-center mb-10">
        <h3 class="text-4xl font-extrabold mb-2" style="color:var(--gold-3)">Construye la imagen de tu negocio</h3>
        <p class="subtext text-lg sm:text-xl">Selecciona el paquete que mejor se adapte a tus objetivos.</p>
      </div>

      <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <div class="card p-6">
          <div class="flex flex-col h-full">
            <h4 class="text-2xl font-extrabold mb-2" style="color:var(--gold-3)">Paquete Inicio</h4>
            <p class="text-sm subtext mb-4">Ideal para comenzar a impulsar tu marca.</p>
            <div class="text-4xl font-extrabold mb-4">$8,900 MXN</div>
            <ul class="space-y-3 text-base list-disc list-inside flex-grow subtext">
              <li><strong class="text-white">20 fotograf√≠as</strong> editadas</li>
              <li><strong class="text-white">3 videos cortos</strong> (30‚Äì45s)</li>
            </ul>
            <a href="#contacto" class="btn-gold btn-sheen px-5 py-2 rounded-full font-bold mt-6 text-center">Contratar</a>
          </div>
        </div>

        <div class="card p-8 bg-white/5 ring-2 ring-[color:var(--gold-3)] transform scale-105 transition-all duration-300 relative">
          <span class="badge-accent absolute top-0 right-0 -mt-3 -mr-3 px-3 py-1 text-sm font-bold rounded-full shadow-lg floating-note">M√°s Popular</span>
          <div class="flex flex-col h-full">
            <h4 class="text-3xl font-extrabold mb-2" style="color:var(--gold-3)">Paquete Crecimiento</h4>
            <p class="text-sm subtext mb-4">Acelera tu crecimiento con contenido completo.</p>
            <div class="text-5xl font-extrabold mb-4">$13,900 MXN</div>
            <ul class="space-y-3 text-base list-disc list-inside flex-grow subtext">
              <li><strong class="text-white">30 fotograf√≠as</strong> editadas</li>
              <li><strong class="text-white">5 videos cortos</strong> (30‚Äì45s)</li>
              <li><strong class="text-white">1 video largo</strong> (1‚Äì2 min)</li>
            </ul>
            <a href="#contacto" class="btn-gold btn-sheen px-5 py-2 rounded-full font-bold mt-6 text-center">Contratar</a>
          </div>
        </div>

        <div class="card p-6">
          <div class="flex flex-col h-full">
            <h4 class="text-2xl font-extrabold mb-2" style="color:var(--gold-3)">Paquete Impacto</h4>
            <p class="text-sm subtext mb-4">Campa√±a integral para dominar tu mercado.</p>
            <div class="text-4xl font-extrabold mb-4">$21,900 MXN</div>
            <ul class="space-y-3 text-base list-disc list-inside flex-grow subtext">
              <li><strong class="text-white">50 fotograf√≠as</strong> editadas</li>
              <li><strong class="text-white">8 videos cortos</strong> (30‚Äì45s)</li>
              <li><strong class="text-white">2 videos largos</strong> (1‚Äì2 min)</li>
              <li><strong class="text-white">10 fotos de producto</strong> adicionales</li>
            </ul>
            <a href="#contacto" class="btn-gold btn-sheen px-5 py-2 rounded-full font-bold mt-6 text-center">Contratar</a>
          </div>
        </div>
      </div>

      <div class="text-center subtext mt-12 text-sm sm:text-base">
        <p class="mb-2">‚ö° Edici√≥n profesional y entrega digital en alta calidad.</p>
        <p class="mb-2">üí≥ 50% de anticipo para reservar fecha.</p>
        <p class="mb-2 font-extrabold text-white">‚è≥ Entrega estimada: 7 d√≠as h√°biles.</p>
        <p>üìå Precios sujetos a IVA.</p>
      </div>
    </div>
  </section>

  <!-- OPINIONES -->
  <section data-route="opiniones" class="hidden-route min-h-screen flex items-center justify-center px-4 py-10">
    <div class="panel max-w-5xl w-full p-6 sm:p-10 bg-black/40">
      <div class="flex items-center gap-3 mb-6">
        <a href="#home" class="btn-gold-outline btn-sheen px-4 py-2 rounded-full font-bold">‚Üê Volver</a>
        <h2 class="text-3xl sm:text-4xl font-extrabold">Opiniones</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <blockquote class="card p-6"><h4 class="text-lg font-extrabold mb-2" style="color:var(--gold-3)">‚ÄúExcelente experiencia‚Äù</h4><p class="subtext">‚ÄúSubi√≥ nuestras reservas en brunch en 3 semanas. Fotograf√≠a que parece cine.‚Äù ‚Äî Cornalina</p></blockquote>
        <blockquote class="card p-6"><h4 class="text-lg font-extrabold mb-2" style="color:var(--gold-3)">‚ÄúEntrega puntual‚Äù</h4><p class="subtext">‚ÄúFotos y video highlight justo como lo quer√≠amos. Recomendado.‚Äù ‚Äî Cliente social</p></blockquote>
      </div>
    </div>
  </section>

  <!-- PORTAFOLIO -->
  <section data-route="portafolio" class="hidden-route min-h-screen flex items-center justify-center px-4 py-10">
    <div class="panel max-w-7xl w-full p-6 sm:p-10 bg-black/40">
      <div class="flex items-center gap-3 mb-6">
        <a href="#home" class="btn-gold-outline btn-sheen px-4 py-2 rounded-full font-bold">‚Üê Volver</a>
        <h2 class="text-3xl sm:text-4xl font-extrabold">Portafolio</h2>
      </div>

      <div class="tabbar mb-6" role="tablist" aria-label="Categor√≠as principales">
        <button class="tab-btn active" data-tab="fotografia" role="tab" aria-controls="tab-fotografia">Fotograf√≠a</button>
        <button class="tab-btn" data-tab="video" role="tab" aria-controls="tab-video">Video</button>
      </div>

      <!-- FOTOGRAF√çA -->
      <section id="tab-fotografia" class="tab-pane">
        <div class="subtabs" role="tablist" aria-label="Subcategor√≠as fotograf√≠a">
          <button class="subtab-btn active" data-subtab="producto" role="tab" aria-controls="sub-producto">Producto</button>
          <button class="subtab-btn" data-subtab="registro" role="tab" aria-controls="sub-registro">Registro</button>
        </div>
        <!-- Producto -->
        <div id="sub-producto" class="subpane">
          <div class="masonry" id="grid-producto" aria-live="polite"></div>
        </div>
        <!-- Registro -->
        <div id="sub-registro" class="subpane hidden">
          <div class="masonry" id="grid-registro" aria-live="polite"></div>
        </div>
      </section>

      <!-- VIDEO (estructura lista para futuro) -->
      <section id="tab-video" class="tab-pane hidden">
        <div class="subtabs" role="tablist" aria-label="Subcategor√≠as video">
          <button class="subtab-btn active" data-subtab="general" role="tab" aria-controls="sub-general">General</button>
          <button class="subtab-btn" data-subtab="redes" role="tab" aria-controls="sub-redes">Redes Sociales</button>
        </div>
        <div id="sub-general" class="subpane">
          <div class="masonry" id="grid-video-general" aria-live="polite"></div>
        </div>
        <div id="sub-redes" class="subpane hidden">
          <div class="masonry" id="grid-video-redes" aria-live="polite"></div>
        </div>
      </section>
    </div>
  </section>

  <!-- CONTACTO -->
  <section data-route="contacto" class="hidden-route min-h-screen flex items-center justify-center px-4 py-10">
    <div class="panel max-w-5xl w-full p-6 sm:p-10 bg-black/40">
      <div class="flex items-center gap-3 mb-6">
        <a href="#home" class="btn-gold-outline btn-sheen px-4 py-2 rounded-full font-bold">‚Üê Volver</a>
        <h2 class="text-3xl sm:text-4xl font-extrabold">Contacto</h2>
      </div>
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="card p-6"><h4 class="text-lg font-extrabold mb-2" style="color:var(--gold-3)">WhatsApp</h4><p class="subtext">Tap para conversar: <a href="https://tapni.com/cruxbetafilm" class="underline" target="_blank" rel="noopener">cruxbetafilm</a></p><a href="https://tapni.com/cruxbetafilm" target="_blank" rel="noopener" class="btn-gold btn-sheen mt-4 inline-block px-5 py-2 rounded-full font-bold">Abrir chat</a></div>
        <div class="card p-6"><h4 class="text-lg font-extrabold mb-2" style="color:var(--gold-3)">Cobertura</h4><p class="subtext">Monterrey y √°rea metropolitana. Viajes a otros estados bajo agenda.</p></div>
        <div class="card p-6"><h4 class="text-lg font-extrabold mb-2" style="color:var(--gold-3)">Entrega</h4><p class="subtext">Fotos en 7 d√≠as. Video highlight en 7‚Äì10 d√≠as.</p></div>
      </div>
    </div>
  </section>

  <!-- LIGHTBOX -->
  <dialog id="lightbox">
    <div class="lb-wrap" id="zoomWrap">
      <button id="lbPrev" class="lb-ctrl" aria-label="Anterior">‚Äπ</button>
      <img id="lbImg" alt="Foto" draggable="false"/>
      <button id="lbNext" class="lb-ctrl" aria-label="Siguiente">‚Ä∫</button>

      <div class="lb-toolbar">
        <button class="lb-btn" id="zoomOut" aria-label="Alejar">‚àí</button>
        <button class="lb-btn" id="zoomReset" aria-label="Restablecer">‚ü≤</button>
        <button class="lb-btn" id="zoomIn" aria-label="Acercar">Ôºã</button>
      </div>
      <button class="lb-close" id="lbClose" aria-label="Cerrar">‚úï</button>
    </div>
  </dialog>

  <!-- VIDEO MODAL (listo para futuro) -->
  <dialog id="videoModal" style="padding:0;border:0;background:transparent">
    <div style="position:relative;width:min(92vw,1000px);aspect-ratio:16/9;background:#000;border-radius:12px;overflow:hidden">
      <iframe id="videoFrame" src="" allowfullscreen style="position:absolute;inset:0;width:100%;height:100%;border:0"></iframe>
    </div>
  </dialog>

  <script>
    /* ====== Router por hash + Failsafe de clic ====== */
    (function(){
      const sections = Array.from(document.querySelectorAll('[data-route]'));
      const routes = sections.map(s => s.getAttribute('data-route'));
      function show(route){
        sections.forEach(s => s.classList.toggle('hidden-route', s.getAttribute('data-route')!==route));
        document.body.classList.toggle('lock', route==='home');
        window.scrollTo({ top: 0, behavior: 'auto' });
      }
      function render(){
        let route = (location.hash || '#home').slice(1);
        if (!routes.includes(route)) route = 'home';
        show(route);
      }
      window.addEventListener('hashchange', render);
      document.addEventListener('click', (e) => {
        const a = e.target.closest('a[href^="#"]');
        if (!a) return;
        const target = (a.getAttribute('href') || '#home').slice(1);
        if (routes.includes(target)) {
          e.preventDefault();
          if (location.hash.slice(1) !== target) location.hash = '#' + target;
          else show(target);
        }
      });
      render();
    })();

    /* ====== Tabs Portafolio ====== */
    const mainTabs = document.querySelectorAll('.tab-btn');
    const panes = { fotografia: document.getElementById('tab-fotografia'), video: document.getElementById('tab-video') };
    mainTabs.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        if(!btn.dataset.tab) return;
        mainTabs.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const t = btn.dataset.tab;
        if(panes.fotografia && panes.video){
          panes.fotografia.classList.toggle('hidden', t!=='fotografia');
          panes.video.classList.toggle('hidden', t!=='video');
        }
      });
    });
    const fotoSubBtns = document.querySelectorAll('#tab-fotografia .subtab-btn');
    const subFoto = { producto: document.getElementById('sub-producto'), registro: document.getElementById('sub-registro') };
    fotoSubBtns.forEach(btn=>{
      btn.addEventListener('click', ()=>{
        fotoSubBtns.forEach(b=>b.classList.remove('active'));
        btn.classList.add('active');
        const t = btn.dataset.subtab;
        Object.entries(subFoto).forEach(([k,el])=> el.classList.toggle('hidden', k!==t));
      });
    });

    /* ====== Anti-descarga (disuasi√≥n) ====== */
    document.addEventListener('contextmenu', e=> e.preventDefault(), {capture:true});
    document.addEventListener('dragstart', e=> e.preventDefault(), {capture:true});
    document.addEventListener('keydown', (e)=>{
      const k = e.key.toLowerCase();
      if ((e.ctrlKey||e.metaKey) && ['s','u','p','c','x','i','j'].includes(k)) { e.preventDefault(); e.stopPropagation(); }
    }, {capture:true});

    /* ====== Masonry: generaci√≥n de tiles desde /img/producto ====== */
    const gridProducto = document.getElementById('grid-producto');

    const PRODUCTO_DIR   = './img/producto/';
    const PRODUCTO_COUNT = 43; // foto (1) ... foto (43)

    // Extensiones detectables
    const EXT_CANDIDATAS = ['jpg','jpeg','png','webp','JPG','JPEG','PNG','WEBP'];
    // Mapa: 5..11 -> jpeg, 18..21 -> png, 39..43 -> png
    const EXT_MAP = {
      5:'jpeg',6:'jpeg',7:'jpeg',8:'jpeg',9:'jpeg',10:'jpeg',11:'jpeg',
      18:'png',19:'png',20:'png',21:'png',
      39:'png',40:'png',41:'png',42:'png',43:'png'
    };

    function posiblesURLs(baseDir, i) {
      const conEspacio = `foto (${i})`;
      const sinEspacio = `foto(${i})`;
      const exts = EXT_MAP[i] ? [EXT_MAP[i], ...EXT_CANDIDATAS] : EXT_CANDIDATAS;
      const urls = [];
      for (const ext of exts) {
        urls.push(baseDir + encodeURIComponent(`${conEspacio}.${ext}`));
        urls.push(baseDir + encodeURIComponent(`${sinEspacio}.${ext}`));
      }
      return Array.from(new Set(urls));
    }

    function cargarConFallback(urls, onOk, onFail, idx=0){
      if(idx>=urls.length){ onFail(); return; }
      const img = new Image();
      img.loading = idx < 6 ? 'eager' : 'lazy';
      img.decoding = 'async';
      img.onload = ()=> onOk(urls[idx], img);
      img.onerror = ()=> cargarConFallback(urls, onOk, onFail, idx+1);
      img.src = urls[idx];
    }

    const urlsOK = []; const fallidas=[];
    function addTile(url, i, probeImg){
      const tile = document.createElement('button');
      tile.type='button';
      tile.className='tile';
      tile.setAttribute('aria-label', `Abrir foto ${i} en grande`);
      tile.dataset.index = i;

      // Altura seg√∫n proporci√≥n real de la imagen
      const setSize = ()=>{
        const w = tile.clientWidth || tile.getBoundingClientRect().width || 300;
        const ratio = probeImg.naturalWidth / probeImg.naturalHeight;
        const h = Math.max(180, Math.round(w / ratio));
        tile.style.height = h + 'px';
      };

      // Fondo + UI
      tile.style.backgroundImage = `url("${url}")`;
      tile.innerHTML = `
        <span class="slot--badge">${i}</span>
        <span class="loupe" aria-hidden="true">
          <svg viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="7"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
        </span>
      `;

      tile.addEventListener('click', ()=> openLightboxFromIndex(i));
      gridProducto.appendChild(tile);
      requestAnimationFrame(setSize);
      window.addEventListener('resize', setSize);
    }

    function renderMasonryProducto(){
      if(!gridProducto) return;
      gridProducto.innerHTML = '';
      for(let i=1;i<=PRODUCTO_COUNT;i++){
        const candidates = posiblesURLs(PRODUCTO_DIR, i);
        cargarConFallback(
          candidates,
          (okUrl, probe) => { urlsOK[i]=okUrl; addTile(okUrl, i, probe); },
          () => {
            fallidas.push(i);
            const ph = document.createElement('div');
            ph.className = 'slot--empty';
            ph.innerHTML = `<div class='plus'>No encontrada<br><small>foto ${i}</small></div>`;
            gridProducto.appendChild(ph);
          }
        );
      }
      setTimeout(()=>{ if(fallidas.length){ console.warn('Fotos NO encontradas:', fallidas); }}, 1500);
    }
    renderMasonryProducto();

    /* ====== LIGHTBOX + ZOOM (sin animaciones, con bot√≥n X) ====== */
    const lb = document.getElementById('lightbox');
    const lbImg = document.getElementById('lbImg');
    const lbPrev = document.getElementById('lbPrev');
    const lbNext = document.getElementById('lbNext');
    const lbClose= document.getElementById('lbClose');
    const zoomWrap = document.getElementById('zoomWrap');
    const zoomInBtn = document.getElementById('zoomIn');
    const zoomOutBtn= document.getElementById('zoomOut');
    const zoomResetBtn=document.getElementById('zoomReset');

    let currentIdx = 1;
    let scale = 1, tx = 0, ty = 0;
    let isPanning = false, startX=0, startY=0, origX=0, origY=0;

    function visibles(){
      return urlsOK
        .map((url,idx)=>({url,idx}))
        .filter(x=>!!x.url);
    }
    function showAt(idx){
      const list = visibles();
      const pos = list.findIndex(x=>x.idx===idx);
      const clampPos = pos<0 ? 0 : pos;
      const item = list[clampPos] || list[0];
      if(!item) return;
      currentIdx = item.idx;
      lbImg.src = item.url;
      scale = 1; tx = 0; ty = 0; applyTransform();
    }
    function openLightboxFromIndex(idx){
      showAt(idx);
      if(typeof lb.showModal==='function') lb.showModal(); else lb.setAttribute('open','');
    }
    function applyTransform(){
      lbImg.style.transform = `translate(${tx}px, ${ty}px) scale(${scale})`;
    }
    function zoomBy(delta){
      const newScale = Math.min(4, Math.max(1, scale + delta));
      if(newScale===1){ tx=0; ty=0; }
      scale = newScale; applyTransform();
    }
    function nav(step){
      const list = visibles();
      if(!list.length) return;
      const pos = list.findIndex(x=>x.idx===currentIdx);
      const next = (pos + step + list.length) % list.length;
      showAt(list[next].idx);
    }

    lbPrev.addEventListener('click', ()=> nav(-1));
    lbNext.addEventListener('click', ()=> nav(1));
    lbClose.addEventListener('click', ()=> lb.close());
    window.addEventListener('keydown', (e)=>{
      if(!lb.open) return;
      if(e.key==='Escape') lb.close();
      if(e.key==='ArrowLeft') nav(-1);
      if(e.key==='ArrowRight') nav(1);
      if(e.key==='+' || (e.key==='='&&(e.ctrlKey||e.metaKey))) { e.preventDefault(); zoomBy(+0.25); }
      if(e.key==='-' || (e.key==='_'&&(e.ctrlKey||e.metaKey))) { e.preventDefault(); zoomBy(-0.25); }
      if(e.key==='0' && (e.ctrlKey||e.metaKey)) { e.preventDefault(); scale=1; tx=ty=0; applyTransform(); }
    });

    // Zoom botones y doble click
    zoomInBtn.addEventListener('click', ()=> zoomBy(+0.25));
    zoomOutBtn.addEventListener('click',()=> zoomBy(-0.25));
    zoomResetBtn.addEventListener('click',()=> { scale=1; tx=ty=0; applyTransform(); });
    lbImg.addEventListener('dblclick', ()=> { scale = scale===1 ? 2 : 1; if(scale===1){ tx=ty=0; } applyTransform(); });

    // Pan al arrastrar (cuando zoom > 1)
    lbImg.addEventListener('mousedown', (e)=>{
      if(scale<=1) return;
      isPanning=true; startX=e.clientX; startY=e.clientY; origX=tx; origY=ty;
    });
    window.addEventListener('mousemove', (e)=>{
      if(!isPanning) return;
      tx = origX + (e.clientX - startX);
      ty = origY + (e.clientY - startY);
      applyTransform();
    });
    window.addEventListener('mouseup', ()=> isPanning=false);

    // Zoom con rueda
    zoomWrap.addEventListener('wheel', (e)=>{
      e.preventDefault();
      const delta = e.deltaY>0 ? -0.2 : +0.2;
      zoomBy(delta);
    }, {passive:false});

    // Cerrar al click fuera
    lb.addEventListener('click',(e)=>{
      const box=lbImg.getBoundingClientRect();
      const outside=e.clientX<box.left||e.clientX>box.right||e.clientY<box.top||e.clientY>box.bottom;
      const clickedClose = e.target.id==='lbClose';
      if(outside && !clickedClose) lb.close();
    });

    /* ====== Video (placeholder para futuro) ====== */
    const vModal=document.getElementById('videoModal'); const vFrame=document.getElementById('videoFrame');
    function openVideo(url){ vFrame.src=url; if(typeof vModal.showModal==='function') vModal.showModal(); else vModal.setAttribute('open',''); }
    vModal.addEventListener('click',(e)=>{ const box=vFrame.getBoundingClientRect(); const outside=e.clientX<box.left||e.clientX>box.right||e.clientY<box.top||e.clientY>box.bottom; if(outside){ vFrame.src=''; vModal.close(); }});

  </script>
</body>
</html> 
